name: Electron æ„å»ºä¸å‘å¸ƒæµæ°´çº¿ï¼ˆWindowsï¼‰

on:
  push:
    branches:
      - master

jobs:
  build:
    name: æ„å»º Windows å®‰è£…åŒ…
    runs-on: windows-latest

    outputs:
      version: ${{ steps.get_version.outputs.version }}

    steps:
      - name: æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4

      - name: å®‰è£… Node.js ç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: "24"
          cache: "npm"

      - name: å®‰è£…é¡¹ç›®ä¾èµ–
        run: npm install

      - name: è¯»å–é¡¹ç›®ç‰ˆæœ¬å·
        id: get_version
        run: |
          $version = node -p "require('./package.json').version"
          echo "version=$version" >> $env:GITHUB_OUTPUT

      - name: æ„å»º Windows åº”ç”¨å®‰è£…åŒ…
        run: npm run build:win

      # -----------------------------
      # macOS æ„å»ºé¢„ç•™ï¼ˆæœªæ¥å¯ç”¨ï¼‰
      # -----------------------------
      # - name: æ„å»º macOS åº”ç”¨å®‰è£…åŒ…
      #   if: runner.os == 'macOS'
      #   run: npm run build:mac
      # -----------------------------

      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: windows-artifacts
          path: |
            dist/**/*
            !dist/**/*.blockmap
            !dist/**/builder-debug.yml

  release:
    name: åˆ›å»ºç‰ˆæœ¬å¹¶å‘å¸ƒ Release
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4

      - name: ä¸‹è½½æ„å»ºäº§ç‰©
        uses: actions/download-artifact@v4
        with:
          name: windows-artifacts
          path: dist/

      - name: åˆ›å»º Git Tag
        run: |
          git tag v${{ needs.build.outputs.version }}
          git push origin v${{ needs.build.outputs.version }}

      - name: å‘å¸ƒåˆ° GitHub Releases
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v${{ needs.build.outputs.version }}
          name: v${{ needs.build.outputs.version }} æ­£å¼ç‰ˆ
          body: |
            ğŸš€ ç‰ˆæœ¬ v${{ needs.build.outputs.version }} å‘å¸ƒ

            æœ¬æ¬¡æ›´æ–°å†…å®¹ï¼š
            - åŠŸèƒ½ä¼˜åŒ–
            - Bug ä¿®å¤
            - æ€§èƒ½æ”¹è¿›

          files: |
            dist/**/*.exe
            dist/**/*.msi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
